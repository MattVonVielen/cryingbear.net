<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>A Unit Testing Dilemma | Crying Bear Studio</title><meta name=keywords content="TDD"><meta name=description content="After returning to blogging after a really long hiatus with some really heavy and emotional stuff, I think I&rsquo;m way the hell overdue for a development-related post.
I&rsquo;ve long been a believer that one of the most important and most overlooked aspects of TDD is making sure the test fails first. To put it another way, here&rsquo;s &ldquo;Gandalf&rsquo;s First Law of Unit Testing&rdquo;:
You shall not pass!
— Gandalf the Grey, in his first (and last) TDD seminar"><meta name=author content="Matt Campbell"><link rel=canonical href=http://www.cryingbear.net/fossils/2009-09-10-a-unit-testing-dilemma/><link crossorigin=anonymous href=/assets/css/stylesheet.1740750342264a4e69b84ddf6899fb02cc95465080d85c57c08bb1d110900bf6.css integrity="sha256-F0B1A0ImSk5puE3faJn7AsyVRlCA2FxXwIux0RCQC/Y=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://www.cryingbear.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://www.cryingbear.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://www.cryingbear.net/favicon-32x32.png><link rel=apple-touch-icon href=http://www.cryingbear.net/apple-touch-icon.png><link rel=mask-icon href=http://www.cryingbear.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="A Unit Testing Dilemma"><meta property="og:description" content="After returning to blogging after a really long hiatus with some really heavy and emotional stuff, I think I&rsquo;m way the hell overdue for a development-related post.
I&rsquo;ve long been a believer that one of the most important and most overlooked aspects of TDD is making sure the test fails first. To put it another way, here&rsquo;s &ldquo;Gandalf&rsquo;s First Law of Unit Testing&rdquo;:
You shall not pass!
— Gandalf the Grey, in his first (and last) TDD seminar"><meta property="og:type" content="article"><meta property="og:url" content="http://www.cryingbear.net/fossils/2009-09-10-a-unit-testing-dilemma/"><meta property="article:section" content="fossils"><meta property="article:published_time" content="2009-09-10T19:26:00-05:00"><meta property="article:modified_time" content="2009-09-10T19:26:00-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="A Unit Testing Dilemma"><meta name=twitter:description content="After returning to blogging after a really long hiatus with some really heavy and emotional stuff, I think I&rsquo;m way the hell overdue for a development-related post.
I&rsquo;ve long been a believer that one of the most important and most overlooked aspects of TDD is making sure the test fails first. To put it another way, here&rsquo;s &ldquo;Gandalf&rsquo;s First Law of Unit Testing&rdquo;:
You shall not pass!
— Gandalf the Grey, in his first (and last) TDD seminar"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Fossils","item":"http://www.cryingbear.net/fossils/"},{"@type":"ListItem","position":2,"name":"A Unit Testing Dilemma","item":"http://www.cryingbear.net/fossils/2009-09-10-a-unit-testing-dilemma/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"A Unit Testing Dilemma","name":"A Unit Testing Dilemma","description":"After returning to blogging after a really long hiatus with some really heavy and emotional stuff, I think I\u0026rsquo;m way the hell overdue for a development-related post.\nI\u0026rsquo;ve long been a believer that one of the most important and most overlooked aspects of TDD is making sure the test fails first. To put it another way, here\u0026rsquo;s \u0026ldquo;Gandalf\u0026rsquo;s First Law of Unit Testing\u0026rdquo;:\nYou shall not pass!\n— Gandalf the Grey, in his first (and last) TDD seminar","keywords":["TDD"],"articleBody":"After returning to blogging after a really long hiatus with some really heavy and emotional stuff, I think I’m way the hell overdue for a development-related post.\nI’ve long been a believer that one of the most important and most overlooked aspects of TDD is making sure the test fails first. To put it another way, here’s “Gandalf’s First Law of Unit Testing”:\nYou shall not pass!\n— Gandalf the Grey, in his first (and last) TDD seminar\nThis step is crucial due to the extreme and surprising ease of writing utterly useless tests. If you’re looking at a unit test and you suspect that it might be useless, here’s one way to confirm your suspicions:\nComment out the entire body of the method under test If needed, uncomment (or stub in) just enough code to make the class compile Run the suspicious unit test again - if it passes when run against an empty method, then it’s utterly useless This isn’t a contrived story; it’s actually happened a couple times where I work. Granted, there may be an easier way to tell the uselessness, if the test in question performs neither assertions nor verification against fakes (mocks, stubs, test-doubles, whatever) and if that ain’t a test smell, I don’t know what is. But while that is an admittedly extreme (though real-world) example, there are a plethora of variations on the unit test that, once everything is inlined, boil down to “Assert.That(true)”. And the risk of writing a useless test rises significantly if you’re (mis)using a mocking framework that supports non-verifying fakes.\nIn any case, I’m also a philosophical believer that with a certain amount of elbow-grease and prestidigitation, it’s possible to wrap legacy code (in the Michael Feathers sense of the phrase) in tests. I say that I’m a philosophical believer of this, since I’ve yet to actually make it work. It certainly doesn’t seem to be a trivial undertaking.\nAnd herein lies the dilemma to which I allude in the post title. When writing a new unit test against a piece of previously-existing and previously-untested code, how can you write the test so that it fails first? Is there a sane way? Should you comment out the method’s code, like in my earlier example, and write the test bit by bit, uncommenting code to make the test pass each time?\n","wordCount":"392","inLanguage":"en","datePublished":"2009-09-10T19:26:00-05:00","dateModified":"2009-09-10T19:26:00-05:00","author":{"@type":"Person","name":"Matt Campbell"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://www.cryingbear.net/fossils/2009-09-10-a-unit-testing-dilemma/"},"publisher":{"@type":"Organization","name":"Crying Bear Studio","logo":{"@type":"ImageObject","url":"http://www.cryingbear.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://www.cryingbear.net/ accesskey=h title="Crying Bear Studio (Alt + H)">Crying Bear Studio</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://www.cryingbear.net/articles/ title=Articles><span>Articles</span></a></li><li><a href=http://www.cryingbear.net/fossils/ title=Fossils><span>Fossils</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>A Unit Testing Dilemma</h1><div class=post-meta><span title='2009-09-10 19:26:00 -0500 -0500'>September 10, 2009</span>&nbsp;·&nbsp;Matt Campbell</div></header><div class=post-content><p>After returning to blogging after a really long hiatus with some <a href=http://www.cryingbear.net/fossils/2009-08-15-a-long-overdue-reality-check-wundarous/>really
heavy and emotional
stuff</a>,
I think I&rsquo;m way the hell overdue for a development-related post.</p><p>I&rsquo;ve long been a believer that one of the most important and most
overlooked aspects of TDD is <em>making sure the test fails first</em>. To put
it another way, here&rsquo;s &ldquo;Gandalf&rsquo;s First Law of Unit Testing&rdquo;:</p><blockquote><p><strong>You shall not pass!</strong></p><p>— <cite>Gandalf the Grey, in his first (and last) TDD seminar</cite></p></blockquote><p>This step is <em>crucial</em> due to the extreme and surprising ease of writing
utterly <strong>useless</strong> tests. If you&rsquo;re looking at a unit test and you
suspect that it might be useless, here&rsquo;s one way to confirm your
suspicions:</p><ul><li>Comment out the entire body of the method under test</li><li>If needed, uncomment (or stub in) just enough code to make the class
compile</li><li>Run the suspicious unit test again - if it passes when run against
an empty method, then it&rsquo;s utterly useless</li></ul><p>This isn&rsquo;t a contrived story; it&rsquo;s actually happened a couple times
where I work. Granted, there may be an easier way to tell the
uselessness, if the test in question performs neither assertions nor
verification against fakes (mocks, stubs, test-doubles, whatever) and if
that ain&rsquo;t a test smell, I don&rsquo;t know what is. But while that is an
admittedly extreme (though real-world) example, there are a plethora of
variations on the unit test that, once everything is inlined, boil down
to &ldquo;Assert.That(true)&rdquo;. And the risk of writing a useless test rises
significantly if you&rsquo;re (mis)using a mocking framework that supports
non-verifying fakes.</p><p>In any case, I&rsquo;m also a philosophical believer that with a certain
amount of elbow-grease and prestidigitation, it&rsquo;s possible to wrap
legacy code (in the Michael Feathers sense of the phrase) in tests. I
say that I&rsquo;m a <em>philosophical</em> believer of this, since I&rsquo;ve yet to
actually make it work. It certainly doesn&rsquo;t seem to be a trivial
undertaking.</p><p>And herein lies the dilemma to which I allude in the post title. When
writing a new unit test against a piece of previously-existing and
previously-untested code, how can you write the test so that it fails
first? Is there a sane way? Should you comment out the method&rsquo;s code,
like in my earlier example, and write the test bit by bit, uncommenting
code to make the test pass each time?</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://www.cryingbear.net/tags/tdd/>TDD</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=http://www.cryingbear.net/>Crying Bear Studio</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>